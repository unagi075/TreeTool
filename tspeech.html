<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>材積計算</title>
    <!-- BootstrapのCSSを読み込む -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body style="background-color: #ffddff;">
    <div class="container mt-5">
    	<font color='red'><p id="error-message"></p></font>
        <div class="form-row">
            <div class="form-group col-3">
                <label for="diameter">直径(cm)</label>
                <input type="number" id="diameter14" class="form-control" min="14" max="40" step="2" value="14" required>
            </div>
            <div class="form-group col-3">
                <label for="length">長さ(m)</label>
                <input type="number" id="length14" class="form-control" min="3" max="4" step="0.5" value="4" required>
            </div>
            <div class="form-group col-4">
                <label for="quantity">本数</label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <button type="button" class="btn btn-dark" onclick="decrementQuantity(14)">-</button>
                    </div>
                    <input type="number" id="quantity14" class="form-control" min="0" value="0" required>
                    <div class="input-group-append">
                        <button type="button" class="btn btn-dark" onclick="incrementQuantity(14)">+</button>
                    </div>
                </div>
            </div>

            <!-- ここから繰り返し -->
            <div class='form-group col-3'><input type='number' id='diameter16' class='form-control' min='14' max='40' step='2' value='16' required></div>
            <div class='form-group col-3'><input type='number' id='length16' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(16)'>-</button></div>
            <input type='number' id='quantity16' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(16)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter18' class='form-control' min='14' max='40' step='2' value='18' required></div>
            <div class='form-group col-3'><input type='number' id='length18' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(18)'>-</button></div>
            <input type='number' id='quantity18' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(18)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter20' class='form-control' min='14' max='40' step='2' value='20' required></div>
            <div class='form-group col-3'><input type='number' id='length20' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(20)'>-</button></div>
            <input type='number' id='quantity20' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(20)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter22' class='form-control' min='14' max='40' step='2' value='22' required></div>
            <div class='form-group col-3'><input type='number' id='length22' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(22)'>-</button></div>
            <input type='number' id='quantity22' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(22)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter24' class='form-control' min='14' max='40' step='2' value='24' required></div>
            <div class='form-group col-3'><input type='number' id='length24' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(24)'>-</button></div>
            <input type='number' id='quantity24' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(24)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter26' class='form-control' min='14' max='40' step='2' value='26' required></div>
            <div class='form-group col-3'><input type='number' id='length26' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(26)'>-</button></div>
            <input type='number' id='quantity26' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(26)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter28' class='form-control' min='14' max='40' step='2' value='28' required></div>
            <div class='form-group col-3'><input type='number' id='length28' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(28)'>-</button></div>
            <input type='number' id='quantity28' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(28)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter30' class='form-control' min='14' max='40' step='2' value='30' required></div>
            <div class='form-group col-3'><input type='number' id='length30' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(30)'>-</button></div>
            <input type='number' id='quantity30' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(30)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter32' class='form-control' min='14' max='40' step='2' value='32' required></div>
            <div class='form-group col-3'><input type='number' id='length32' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(32)'>-</button></div>
            <input type='number' id='quantity32' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(32)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter34' class='form-control' min='14' max='40' step='2' value='34' required></div>
            <div class='form-group col-3'><input type='number' id='length34' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(34)'>-</button></div>
            <input type='number' id='quantity34' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(34)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter36' class='form-control' min='14' max='40' step='2' value='36' required></div>
            <div class='form-group col-3'><input type='number' id='length36' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(36)'>-</button></div>
            <input type='number' id='quantity36' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(36)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter38' class='form-control' min='14' max='40' step='2' value='38' required></div>
            <div class='form-group col-3'><input type='number' id='length38' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(38)'>-</button></div>
            <input type='number' id='quantity38' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(38)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter40' class='form-control' min='14' max='40' step='2' value='40' required></div>
            <div class='form-group col-3'><input type='number' id='length40' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(40)'>-</button></div>
            <input type='number' id='quantity40' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(40)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter42' class='form-control' min='14' max='40' step='2' value='42' required></div>
            <div class='form-group col-3'><input type='number' id='length42' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(42)'>-</button></div>
            <input type='number' id='quantity42' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(42)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter44' class='form-control' min='14' max='40' step='2' value='44' required></div>
            <div class='form-group col-3'><input type='number' id='length44' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(44)'>-</button></div>
            <input type='number' id='quantity44' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(44)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter46' class='form-control' min='14' max='40' step='2' value='46' required></div>
            <div class='form-group col-3'><input type='number' id='length46' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(46)'>-</button></div>
            <input type='number' id='quantity46' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(46)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter48' class='form-control' min='14' max='40' step='2' value='48' required></div>
            <div class='form-group col-3'><input type='number' id='length48' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(48)'>-</button></div>
            <input type='number' id='quantity48' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(48)'>+</button> </div>
            </div></div>
            <div class='form-group col-3'><input type='number' id='diameter50' class='form-control' min='14' max='40' step='2' value='50' required></div>
            <div class='form-group col-3'><input type='number' id='length50' class='form-control' min='3' max='4' step='0.5' value='4' required></div>
            <div class='form-group col-4'><div class='input-group'>
            <div class='input-group-prepend'><button type='button' class='btn btn-dark' onclick='decrementQuantity(50)'>-</button></div>
            <input type='number' id='quantity50' class='form-control' min='0' value='0' required>
            <div class='input-group-append'><button type='button' class='btn btn-dark' onclick='incrementQuantity(50)'>+</button> </div>
            </div></div>

            <!-- ここまで繰り返し -->
	    </div>
        <div class="mt-4">
            <h3>計算結果<br></h3> 
            <p id="result"></p>
        </div>
    </div>
	<div class="fixed-bottom">
        <div class="card text-bg-dark">
            <div class="card-head">
                <h4 class="mb-2" id="version" >材積</h4>
                ver2.0m
            </div>
        </div>
		    <div class="fixed-bottom d-flex justify-content-center">
		    	<input type="image" id="start-button" src="png/mic_black.png" width="90" height="90">
		    </div>
			<div class="fixed-bottom d-flex justify-content-end">
		    	<button id="end-button" class="btn btn-dark">計算</button>
		    </div>
    </div>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        const endButton = document.getElementById('end-button');
	    endButton.addEventListener('click', () => {
            
            document.getElementById('result').innerText = '';
            var total = 0;
            for(var num=14; num<=50; num = num + 2){
                var diameter = document.getElementById('diameter'+num).value;
                var length   = document.getElementById('length'+num).value;
                var quantity = document.getElementById('quantity'+num).value;
                var zaitanka = Math.round(diameter*diameter*length/10)/1000;
                if(quantity > 0){
                    var volume = zaitanka * quantity;
                    total = total + volume;
                    var result = diameter + "cm:: " + ( '00' + quantity ).slice( -2 ) + " 本 × 単材積: " + zaitanka.toFixed(3) + "m³ = 材積: " + volume.toFixed(3) + "m³ \n";
                    document.getElementById('result').innerText = document.getElementById('result').innerText + result;
                }
            }
            document.getElementById('result').innerText = document.getElementById('result').innerText + "合計: " + total.toFixed(3)  +"m³\n\n\n\n";
	        scrollTo(0, 2000);
        });

        var beforeNum=0;
        var recFlg = 1;
        var recrcvflg = 0;
        //音声認識
        window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if ('SpeechRecognition' in window) {
            const recognition = new SpeechRecognition();
            recognition.lang = 'ja-JP';  // 日本語に設定
            recognition.interimResults = false;  // 中間結果を表示しない
            recognition.maxAlternatives = 1;

            const startButton = document.getElementById('start-button');
            const resultElement = document.getElementById('result');

            startButton.addEventListener('click', () => {
                if(recrcvflg==0){
                    var speechText = "";
                    const uttr = new SpeechSynthesisUtterance(speechText);
                    uttr.lang = 'ja-JP';
                    speechSynthesis.speak(uttr);
                    recFlg=1;
                    recrcvflg=1;
                    recognition.start();
                }else{
                    recrcvflg=0;
                }
                
            });

            function recStart(){
                if(recFlg == 0 && recrcvflg==1){
                    recFlg=1;
                    try{
                        recognition.start();
                    } catch(e) {
                        recFlg=0;
                    }
                }
            }
            window.setInterval(recStart, 500);

            recognition.addEventListener('result', (event) => {
                const transcript = event.results[0][0].transcript;
	        	document.getElementById('start-button').src="png/mic_black.png"
                var keywordErrorFlg = true;
                //キーワード：「終わり」があれば音声入力終了
                alert(keywordErrorFlg);
                if(transscript.indexOf("終わり")>0){
                    recrcvflg = 0;
                    keywordErrorFlg = false;
                }
                alert(keywordErrorFlg);
                //キーワード：数字があれば最後の２桁を抽出して、１４～５０までの数字であれば本数を上げる
                tmpStr = transcript.replace(/[^0-9]/g, "").slice(-2);
                alert(tmpStr);
                if("14 15 16 18 20 22 24 26 28 30 32 34 36 38 40 42 44 46 48 50".indexOf(tmpStr)>0){
                    incrementQuantity(Number(tmpStr));
                    scrollTo(0, Number(tmpStr)*18-200);
                    keywordErrorFlg = false;
                }
                //キーワードが認識できない場合
                if(keywordErrorFlg==True){
                    document.getElementById('quantity'+beforeNum).style.backgroundColor = '';
                    scrollTo(0, 0);
            	    document.getElementById('error-message').innerText = "※数値を認識できません。認識ワード="+transcript;
                }
                recFlg=0;
            });

            recognition.addEventListener('error', (event) => {
                resultElement.textContent = `エラー: ${event.error}`;
		        document.getElementById('start-button').src="png/mic_black.png"
            	document.getElementById('error-message').innerText =  `※音声認識エラー: ${event.error}`;
            });

            recognition.addEventListener('end', () => {
                startButton.textContent = '音声入力を開始';
		        document.getElementById('start-button').src="png/mic_black.png"
            });

            recognition.addEventListener('start', () => {
                startButton.textContent = '認識中...';
        		document.getElementById('start-button').src="png/mic_red.png"
            	document.getElementById('error-message').innerText = "";
            });
        } else {
            alert('このブラウザは音声認識をサポートしていません。');
        }

        function incrementQuantity(num) {
            
            var speechText = num + "センチに追加";
            const uttr = new SpeechSynthesisUtterance(speechText);
            uttr.lang = 'ja-JP';
            speechSynthesis.speak(uttr);
            const quantityInput = document.getElementById('quantity'+num);
            quantityInput.value = parseInt(quantityInput.value) + 1;
            document.getElementById('quantity'+num).style.backgroundColor = '#dcffff';
            document.getElementById('diameter'+num).style.backgroundColor = '#dcffff';
            if (beforeNum != 0 && beforeNum != num) {
 	            document.getElementById('quantity'+beforeNum).style.backgroundColor = '';
                document.getElementById('diameter'+beforeNum).style.backgroundColor = '';
	        }
	        beforeNum = num;
            //await sleep(2000);
        }

        function decrementQuantity(num) {
            const quantityInput = document.getElementById('quantity'+num);
            const newValue = parseInt(quantityInput.value) - 1;
            quantityInput.value = Math.max(newValue, 0);
        }

        const sleep = (time) => new Promise((r) => setTimeout(r, time));//timeはミリ
    </script>
</body>
</html>

